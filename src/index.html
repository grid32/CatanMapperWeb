<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">

		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="mobile-web-app-capable" content="yes">

		<title>Catan Random Map Generator</title>

		<script src="./js/sprite.js"></script>
		<script src="./js/index.js"></script>
		<script src="./js/map.js"></script>

		<style>
			canvas
			{
				display: block;
				position: absolute;
				margin: auto;
				top: 0;
				bottom: 0;
				left: 0;
				right: 0;
			}
		</style>
	</head>
	<body>
		<input type = "checkbox" name = "sizeChk" onclick = "showMe('size', this.checked)">Use custom size
		<br>
		<div id = "sizeDiv" style = "display: none; border:1px solid black;">
			<span>Height: </span> <span id = "height">5</span>
			<br>
			<input type = "range" min = "1" max = "11" value = "5" step = "2" onchange="setHeight(this.value)"/>
			<br>
			<br>
			<span>Width: </span> <span id = "width">5</span>
			<br>
			<input type = "range" min = "1" max = "11" value = "5" step = "1" onchange="setWidth(this.value)"/>
		</div>
		<br>

		<input type = "checkbox" name = "desertChk" onclick = "showMe('desert', this.checked)">Use desert hexes
		<br>
		<div id = "desertDiv" style = "display: none; border:1px solid black;">
			<span>Deserts: </span> <span id = "desert">0</span>
			<br>
			<input id = "desertSld" type = "range" min = 1 max = 0 value = 0 step = "1" onchange="setDesertCount(this.value)"/>
		</div>
		<br>

		<div>
			<!-- TODO: Finish interface. -->
		</div>

		<canvas id = "right"></canvas>
	</body>
	<script>
		var mapHeight = 5;
		var mapWidth = 5;
		var desertMax = 1;
		var desertCount = 0;

		document.getElementById("desertSld").max = desertMax;
		document.getElementById("desertSld").value = 1;
		document.getElementById("desert").innerHTML = 1;

		function showMe(section, checked)
		{
			if(section == "size")
			{
				if(checked == false)
				{
					document.getElementById("sizeDiv").style.display = "none";
					defaultMapSize();
				}
				else
				{
					document.getElementById("sizeDiv").style.display = "inline-block";
					mapHeight = Math.floor(document.getElementById("height").innerHTML);
					mapWidth = Math.floor(document.getElementById("width").innerHTML);
				}
			}
			if(section == "desert")
			{
				if(checked == false)
				{
					document.getElementById("desertDiv").style.display = "none";
					desertCount = 0;
				}
				else
				{
					document.getElementById("desertDiv").style.display = "inline-block";
					desertCount = document.getElementById("desert").innerHTML
				}
			}
			update(mapWidth, mapHeight);
		}
		function setHeight(inHeight)
		{
			inHeight = Math.floor(inHeight);
			mapHeight = inHeight;
			document.getElementById("height").innerHTML = inHeight;
			update(mapWidth, mapHeight)
		}
		function setWidth(inWidth)
		{
			inWidth = Math.floor(inWidth);
			mapWidth = inWidth;
			document.getElementById("width").innerHTML = inWidth;
			update(mapWidth, mapHeight)
		}
		function defaultMapSize()
		{
			mapWidth = 5;
			mapHeight = 5;
			//TODO: Calculate default sizes.
		}
		function setDesertCount(inCount)
		{
			desertCount = inCount;
			document.getElementById("desert").innerHTML = inCount;
			update(mapWidth, mapHeight);
		}

		var img = new Image();
		img.onload = function()
		{
			initSprites(this);
			run();
		}

		img.src = "../res/sheet.png";

		function run()
		{
			update(5, 5);
			window.addEventListener("resize", resize, false);
		}

		function resize()
		{
			update(mapWidth, mapHeight);
		}

		function render(mapCanvas, scaledMapCanvas, windowWidth, windowHeight, mapWidth, mapHeight)
		{
			var heightMod = mapHeight/mapWidth, widthMod = mapWidth/mapHeight;

			//Resize canvas based on window size.
			if(windowWidth < windowHeight)
			{
				windowHeight = windowWidth;
			}
			else
			{
				windowWidth = windowHeight;
			}

			//Resize canvas to correct shape
			if(mapWidth > mapHeight)
			{
				windowHeight /= widthMod;
			}
			else
			{
				windowWidth /= heightMod;
			}

			mapCanvas.width = s_desert.width * mapWidth;
			mapCanvas.height = ((s_desert.height - (0.246 * s_desert.height)) * (mapHeight - 1)) + s_desert.height;

			var ctx = mapCanvas.getContext("2d");
			drawMap(ctx, mapWidth, mapHeight);

			var scaledCtx = scaledMapCanvas.getContext("2d");
			scaledMapCanvas.width = windowWidth - 20;
			scaledMapCanvas.height = windowHeight - 20;
			scaledCtx.drawImage(mapCanvas, 	0, 0, mapCanvas.width, mapCanvas.height, 
											0, 0, scaledMapCanvas.width, scaledMapCanvas.height);
		}

		//TODO: Set up typeCount and pass to drawMap.
		function update(mapWidth, mapHeight)
		{
			var mapCanvas, scaledMapCanvas;

			mapCanvas = document.createElement("canvas");
			scaledMapCanvas = document.getElementById("right");

			//Get window size.
			var width = window.innerWidth;
			var height = window.innerHeight;

			//Make scaledMapCanvas fill bottom or right half of the window.
			if(height > width)
			{
				height /= 2;
				scaledMapCanvas.style.top = height + "px";
				scaledMapCanvas.style.left = "10px";
			}
			else
			{
				width /= 2;
				scaledMapCanvas.style.left = width + "px";
				scaledMapCanvas.style.top = "10px";
			}

			//document.body.innerHTML = ""; //Clear body.
			

			//Redraw map.
			render(mapCanvas, scaledMapCanvas, width, height, mapWidth, mapHeight);
		}
	</script>
</html>